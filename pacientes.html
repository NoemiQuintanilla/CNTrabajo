<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="estilo.css">
    <title>Pacientes</title>
</head>
<body id="pacientes">
    <div class="row">
        <div class="col-md-6">
            <br>
            &nbsp; &nbsp; &nbsp; &nbsp;
            <a href="index.html"><img src="imagenes/utc.png" alt="" class="logo"></a>
            <br>
        </div>
        <div class="col-md-6">
            <br>
            &nbsp; &nbsp; &nbsp; &nbsp;
            <a href="index.html" class="salir">Salir</a>
            <br>
        </div>
    </div>
    <center><h1 class="txt3 ">Gestion de Pacientes</h1></center>
    <hr>
    
    <form id="form-veterinaria">
        <div class="row">
            <div class="col-md-5">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Codigo:</b> </label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <input type="text" id="codigo" class="alert alert-warning" >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Edad: </b></label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <input type="text" id="edad" class="alert alert-warning" >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
                <label for=""><b>Fecha de nacimiento: </b></label>
                &nbsp;
                <input type="date" id="fecha_nacimiento" class="alert alert-warning" >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Nombre:</b> </label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; 
                <input type="text" id="nombre" class="alert alert-warning"  >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Propietario: </b></label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; 
                <input type="text" id="propietario" class="alert alert-warning" >
            </div>
            <div class="col-md-4">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Color: </b></label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;
                <input type="text" id="color" class="alert alert-warning" >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Especie: </b></label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
                <input type="text" id="especie" class="alert alert-warning" >
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Genéro:</b> </label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <input type="text" id="genero" class="alert alert-warning">
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Peso:</b> </label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; 
                <input type="text" id="peso" class="alert alert-warning">
                <br>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                <label for=""><b>Raza:</b> </label>
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; 
                <input type="text" id="raza" class="alert alert-warning" >
            </div>
            <div class="col-md-3">
                <br>
                <br>
                <button type="submit" class="btn btn-success" id="btn-submit">Agregar paciente</button>
                <hr>
                <center>
                    <input type="text" name="buscar" id="buscar" class="alert alert-warning" placeholder="Ingrese código">
                    <br>
                    <button type="button" id="btn-buscar" class="btn btn-dark">Buscar</button>
                    <button type="button" id="btn-limpiar" class="btn btn-info">Limpiar</button> 
                    <hr>
                </center>
            </div>             
        </div>
    </form>  
    
    <!-- Contenedor de tarjetas para mostrar los pacientes -->
    <div class="container">
        <center><h2>Lista de Pacientes</h2></center>
        <div class="row" id="lista-pacientes">
            <!-- Las tarjetas de los pacientes se insertarán aquí -->
        </div>
    </div>

    <!-- Modal para editar paciente -->
    <div class="modal fade" id="modalEditar" tabindex="-1" aria-labelledby="modalEditarLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalEditarLabel">Editar Paciente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Formulario dentro del modal para editar los datos del paciente -->
                    <form id="form-editar">
                        <div class="mb-3">
                            <label for="editCodigo" class="form-label">Código</label>
                            <input type="text" class="form-control" id="editCodigo" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="editNombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="editNombre">
                        </div>
                        <div class="mb-3">
                            <label for="editPropietario" class="form-label">Propietario</label>
                            <input type="text" class="form-control" id="editPropietario">
                        </div>
                        <div class="mb-3">
                            <label for="editEdad" class="form-label">Edad</label>
                            <input type="text" class="form-control" id="editEdad">
                        </div>
                        <div class="mb-3">
                            <label for="editFechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="editFechaNacimiento">
                        </div>
                        <div class="mb-3">
                            <label for="editColor" class="form-label">Color</label>
                            <input type="text" class="form-control" id="editColor">
                        </div>
                        <div class="mb-3">
                            <label for="editEspecie" class="form-label">Especie</label>
                            <input type="text" class="form-control" id="editEspecie">
                        </div>
                        <div class="mb-3">
                            <label for="editGenero" class="form-label">Género</label>
                            <input type="text" class="form-control" id="editGenero">
                        </div>
                        <div class="mb-3">
                            <label for="editPeso" class="form-label">Peso</label>
                            <input type="text" class="form-control" id="editPeso">
                        </div>
                        <div class="mb-3">
                            <label for="editRaza" class="form-label">Raza</label>
                            <input type="text" class="form-control" id="editRaza">
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAv2YFuqtaX6AcoRE7t15WtLGjnjIoi400",
            authDomain: "veterinaria-144cf.firebaseapp.com",
            projectId: "veterinaria-144cf",
            storageBucket: "veterinaria-144cf.appspot.com",
            messagingSenderId: "895686591577",
            appId: "1:895686591577:web:d0c78bb26bd16526e61d48"
        };
      
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById("form-veterinaria");
            const listaPacientes = document.getElementById("lista-pacientes");

            form.addEventListener("submit", function(e) {
                e.preventDefault();
                
                const paciente = {
                    codigo: document.getElementById("codigo").value,
                    nombre: document.getElementById("nombre").value,
                    propietario: document.getElementById("propietario").value,
                    edad: document.getElementById("edad").value,
                    fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
                    color: document.getElementById("color").value,
                    especie: document.getElementById("especie").value,
                    genero: document.getElementById("genero").value,
                    peso: document.getElementById("peso").value,
                    raza: document.getElementById("raza").value
                };

                const tarjetaPaciente = document.createElement("div");
                tarjetaPaciente.className = "col-md-4";
                tarjetaPaciente.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">${paciente.nombre}</h5>
                            <p class="card-text"><b>Codigo:</b> ${paciente.codigo}</p>
                            <p class="card-text"><b>Propietario:</b> ${paciente.propietario}</p>
                            <p class="card-text"><b>Edad:</b> ${paciente.edad}</p>
                            <p class="card-text"><b>Fecha de Nacimiento:</b> ${paciente.fecha_nacimiento}</p>
                            <p class="card-text"><b>Color:</b> ${paciente.color}</p>
                            <p class="card-text"><b>Especie:</b> ${paciente.especie}</p>
                            <p class="card-text"><b>Género:</b> ${paciente.genero}</p>
                            <p class="card-text"><b>Peso:</b> ${paciente.peso}</p>
                            <p class="card-text"><b>Raza:</b> ${paciente.raza}</p>
                            <button class="btn btn-primary" onclick="openEditModal('${paciente.codigo}')">Editar</button>
                        </div>
                    </div>
                `;
                
                listaPacientes.appendChild(tarjetaPaciente);
                form.reset();
            });

            document.getElementById("btn-buscar").addEventListener("click", function() {
                const codigo = document.getElementById("buscar").value;
                const tarjetas = listaPacientes.getElementsByClassName("card");
                let encontrado = false;
                
                for (const tarjeta of tarjetas) {
                    if (tarjeta.innerText.includes(codigo)) {
                        tarjeta.style.display = "block";
                        encontrado = true;
                    } else {
                        tarjeta.style.display = "none";
                    }
                }

                if (!encontrado) {
                    alert("No se encontró ningún paciente con ese código.");
                }
            });

            document.getElementById("btn-limpiar").addEventListener("click", function() {
                const tarjetas = listaPacientes.getElementsByClassName("card");
                for (const tarjeta of tarjetas) {
                    tarjeta.style.display = "block";
                }
                document.getElementById("buscar").value = "";
            });
        });

        function openEditModal(codigo) {
            const tarjetas = document.getElementsByClassName("card");

            for (const tarjeta of tarjetas) {
                if (tarjeta.innerText.includes(codigo)) {
                    const nombre = tarjeta.querySelector(".card-title").innerText;
                    const propietario = tarjeta.querySelector(".card-text:nth-child(3)").innerText.split(": ")[1];
                    const edad = tarjeta.querySelector(".card-text:nth-child(4)").innerText.split(": ")[1];
                    const fecha_nacimiento = tarjeta.querySelector(".card-text:nth-child(5)").innerText.split(": ")[1];
                    const color = tarjeta.querySelector(".card-text:nth-child(6)").innerText.split(": ")[1];
                    const especie = tarjeta.querySelector(".card-text:nth-child(7)").innerText.split(": ")[1];
                    const genero = tarjeta.querySelector(".card-text:nth-child(8)").innerText.split(": ")[1];
                    const peso = tarjeta.querySelector(".card-text:nth-child(9)").innerText.split(": ")[1];
                    const raza = tarjeta.querySelector(".card-text:nth-child(10)").innerText.split(": ")[1];

                    document.getElementById("editCodigo").value = codigo;
                    document.getElementById("editNombre").value = nombre;
                    document.getElementById("editPropietario").value = propietario;
                    document.getElementById("editEdad").value = edad;
                    document.getElementById("editFechaNacimiento").value = fecha_nacimiento;
                    document.getElementById("editColor").value = color;
                    document.getElementById("editEspecie").value = especie;
                    document.getElementById("editGenero").value = genero;
                    document.getElementById("editPeso").value = peso;
                    document.getElementById("editRaza").value = raza;

                    const modal = new bootstrap.Modal(document.getElementById("modalEditar"));
                    modal.show();

                    const formEditar = document.getElementById("form-editar");
                    formEditar.onsubmit = function(e) {
                        e.preventDefault();
                        
                        tarjeta.querySelector(".card-title").innerText = document.getElementById("editNombre").value;
                        tarjeta.querySelector(".card-text:nth-child(3)").innerText = `Propietario: ${document.getElementById("editPropietario").value}`;
                        tarjeta.querySelector(".card-text:nth-child(4)").innerText = `Edad: ${document.getElementById("editEdad").value}`;
                        tarjeta.querySelector(".card-text:nth-child(5)").innerText = `Fecha de Nacimiento: ${document.getElementById("editFechaNacimiento").value}`;
                        tarjeta.querySelector(".card-text:nth-child(6)").innerText = `Color: ${document.getElementById("editColor").value}`;
                        tarjeta.querySelector(".card-text:nth-child(7)").innerText = `Especie: ${document.getElementById("editEspecie").value}`;
                        tarjeta.querySelector(".card-text:nth-child(8)").innerText = `Género: ${document.getElementById("editGenero").value}`;
                        tarjeta.querySelector(".card-text:nth-child(9)").innerText = `Peso: ${document.getElementById("editPeso").value}`;
                        tarjeta.querySelector(".card-text:nth-child(10)").innerText = `Raza: ${document.getElementById("editRaza").value}`;
                        
                        modal.hide();
                    };

                    break;
                }
            }
        }
        
    </script>
</body>
</html>
